<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Using Derivations from Nix - Nix-Book</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="ch00-00-the-nix-package-manager.html">The Nix Package Manager</a></li><li class="chapter-item expanded affix "><a href="ch01-00-forward.html">Forward</a></li><li class="chapter-item expanded affix "><a href="ch02-00-introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="ch03-00-installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="ch04-00-derivations.html"><strong aria-hidden="true">2.</strong> Derivations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch04-01-create-a-derivation.html"><strong aria-hidden="true">2.1.</strong> Create a Derivation</a></li><li class="chapter-item expanded "><a href="ch04-02-realise-a-derivation.html"><strong aria-hidden="true">2.2.</strong> Realise a Derivation</a></li><li class="chapter-item expanded "><a href="ch04-03-using-derivations-from-nix.html" class="active"><strong aria-hidden="true">2.3.</strong> Using Derivations from Nix</a></li></ol></li><li class="chapter-item expanded "><a href="ch05-00-the-nix-language.html"><strong aria-hidden="true">3.</strong> The Nix Language</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch05-01-language-basics.html"><strong aria-hidden="true">3.1.</strong> Language Basics</a></li><li class="chapter-item expanded "><a href="ch05-02-functions.html"><strong aria-hidden="true">3.2.</strong> Functions</a></li><li class="chapter-item expanded "><a href="ch05-03-imports-and-callpackage.html"><strong aria-hidden="true">3.3.</strong> Imports and callPackage</a></li><li class="chapter-item expanded "><a href="ch05-04-best-practices.html"><strong aria-hidden="true">3.4.</strong> Best Practices</a></li><li class="chapter-item expanded "><a href="ch05-05-common-mistakes.html"><strong aria-hidden="true">3.5.</strong> Common Mistakes</a></li></ol></li><li class="chapter-item expanded "><a href="ch06-00-building-a-nix-package.html"><strong aria-hidden="true">4.</strong> Building a Nix Package</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="ch06-01-simple-c-program.html"><strong aria-hidden="true">4.1.</strong> Simple C program</a></li><li class="chapter-item expanded "><a href="ch06-02-stdenv.html"><strong aria-hidden="true">4.2.</strong> Stdenv</a></li><li class="chapter-item expanded "><a href="ch06-03-phases.html"><strong aria-hidden="true">4.3.</strong> Phases</a></li><li class="chapter-item expanded "><a href="ch06-04-build-dependencies.html"><strong aria-hidden="true">4.4.</strong> Build Dependencies</a></li><li class="chapter-item expanded "><a href="ch06-05-runtime-dependencies.html"><strong aria-hidden="true">4.5.</strong> Runtime Dependencies</a></li><li class="chapter-item expanded "><a href="ch06-06-building-packages-for-other-toolchains.html"><strong aria-hidden="true">4.6.</strong> Building Packages for Other Toolchains</a></li><li class="chapter-item expanded "><a href="ch06-07-building-packages-for-other-languages.html"><strong aria-hidden="true">4.7.</strong> Building Packages for Other Languages</a></li><li class="chapter-item expanded "><a href="ch06-08-patching.html"><strong aria-hidden="true">4.8.</strong> Patching</a></li><li class="chapter-item expanded "><a href="ch06-09-multiple-outputs.html"><strong aria-hidden="true">4.9.</strong> Multiple Outputs</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Nix-Book</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="using-derivations-from-nix"><a class="header" href="#using-derivations-from-nix">Using Derivations from Nix</a></h1>
<p>The derivation is the main abstraction of nix. All of
Nixpkgs and NixOS is created by leveraging derivations
to create new derivations, scripts, services, and even
entire linux distributions. The ability to compose these
usecases with uniquely named packages allows nix the
freedom to aggressively share common dependencies, meanwhile
allowing the flexibility to have potentially incompatible
packages available on the system.</p>
<p>The nix language allows for consumption of derivations
to be quite transparent. For example:</p>
<pre><code>$ cat hello.nix
let
  pkgs = import &lt;nixpkgs&gt; { };
in
  pkgs.writeScriptBin &quot;greet.sh&quot; ''
    ${pkgs.hello}/bin/hello -g &quot;Hello $USER!&quot;
  ''

$ nix-build hello.nix
this derivation will be built:
  /nix/store/xd9qpwnvybm9p8k2szhkvpd2ym85is9p-greet.sh.drv
building '/nix/store/xd9qpwnvybm9p8k2szhkvpd2ym85is9p-greet.sh.drv'...
/nix/store/h8yxaciazc8basn9l335bmdrpfak0aqk-greet.sh

$ cat ./result/bin/greet.sh
/nix/store/mg35qkhk7wqbhhykpakds4fsm1riy8ga-hello-2.12.1/bin/hello -g &quot;Hello $USER!&quot;

$ ./result/bin/greet.sh
Hello jon!
</code></pre>
<p>We created a <code>greet.sh</code> script which will greet the user.
Nix first created the &quot;derivation&quot; (build plan) of our script at
<code>/nix/store/&lt;hash&gt;-greet.sh.drv</code>, and then realised (built) the derivation as
<code>/nix/store/&lt;hash&gt;-greet.sh</code>.
We can see from the contents of the resulting file that
<code>pkgs.hello</code> was substituted for the realised output path.
This allows for us to not worry about what the unique name
of the derivation will be, but rather worry about the 
contents post realisation.</p>
<p>Although this may not seem markedly better than other package
management workflows such as: please install these tools, then run
this script. There is quite a lot of benefit to leveraging nix whether
it's to create scripts or build more software:</p>
<ul>
<li>Use of exact versions which you control
<ul>
<li>For example, which version of python or node do you have?</li>
</ul>
</li>
<li>No longer dependent on the state of the consuming system
<ul>
<li>For example, do you have python installed?</li>
</ul>
</li>
<li>Use of multiple versions of the same software
<ul>
<li>Want to use NodeJS v14 in one script, but NodeJS v16 in another? No problem.</li>
</ul>
</li>
</ul>
<p>Although many ecosystems will have ecosystem specific solutions to these solutions
(e.g. tox for python, nvm for node), nix provides a universal abstraction for
native dependencies and any downstream dependencies.</p>
<h3 id="use-of-outpath-as-a-tostring"><a class="header" href="#use-of-outpath-as-a-tostring">Use of &quot;outPath&quot; as a toString</a></h3>
<p>This is one of the oddities of nix, but stringification of
an object which contains a key &quot;outPath&quot; will return
the contents of the &quot;outPath&quot; key. Since all derivations
will have an outPath, any usage of them in a string
will yeild the store path that they create.</p>
<pre><code class="language-nix">nix-repl&gt; a = { outPath = &quot;foo&quot;; }

nix-repl&gt; &quot;${a} bar&quot;
&quot;foo bar&quot;
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="ch04-02-realise-a-derivation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="ch05-00-the-nix-language.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="ch04-02-realise-a-derivation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="ch05-00-the-nix-language.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
